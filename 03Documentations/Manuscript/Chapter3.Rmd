---
title: "Chapter4"
author: "jian (AKA Frank) liu"
date: "17/01/2021"
output:
  html_document:
    df_print: paged
  word_document:
    reference_docx: dissertationTemplate.docx
always_allow_html: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE,
                      fig.align = "center", fig.width = 10, fig.height = 7, 
                      dpi = 300)
options(scipen = 999)
#Constants
outlier.colour = "#ff0000"
source(here::here("02Scripts/R/packages.R"))
source(here::here("02Scripts/R/functions.R"))
path_richard <- "C:/Users/cflfcl/Dropbox/Data/APSIM_Sim.xlsx"
id_vars <- c("Experiment", "SowingDate", "Clock.Today", "DAS")

data_sw <- read_Sims(path = path_richard)

value_vars <-  grep("SWmm\\.\\d.", colnames(data_sw), value = TRUE)
sw_mean_new <- colwise_meanSW(data_sw)

# Colour p
blues <- c("#0f5e9c",
           "#2389da",
           "#1ca3ec",
           "#5abcd8",
           "#74ccf4")
names(blues) <- blues 
ggplot(data.frame(x = blues, y = 1),aes(x, y, fill = x)) +
  geom_col() +
  scale_fill_manual(name = "", values = blues)+
  theme_void()

magicDate <- "2011-06-25"
```

### LEAR response to temp and photoperiod
```{r}


x = c(1, 15, 30, 40)
y = c(0, 10, 25, 0)
lab = c("T[b]", "T[i]", "T[o]", "T[m]")
df_tt <- data.frame(x =  x, y =  y, z = lab)
p_tt <- df_tt %>% 
  ggplot(aes(x, y )) +
  geom_line(size = 1.5) + 
  geom_text(aes( y = y +3, label =  bquote(.(z))), size = 12, nudge_x = 1, nudge_y = 1,
            parse = TRUE) +
  scale_y_continuous(expand = c(0,0), limits = c(0, 35))+
  scale_x_continuous(expand = c(0,0), limits = c(0, 43)) +
  theme_classic()+
  theme(panel.background = element_rect(fill = NA, colour = "black"),
        text = element_text(size = 16)) +
  labs( x = "Air Temperature (\u00B0C)", 
        y = "Thermal time (\u00B0Cd)")

a = c(8, 10, 16.5,  11.5, 12, 16.5)
b = c(0, 0.0056, 0.015,  0, 0.018, 0.02)
lab = c(rep("Decreasing", 3), rep("Increasing", 3))
df_pp <- data.frame(a , b , lab)
p_pp <- df_pp %>% 
  ggplot(aes(a , b)) +
  geom_line(size = 1.5) +
  scale_y_continuous(expand = c(0,0), limits = c(0, 0.025))+
  scale_x_continuous(expand = c(0,0), limits = c(7, 17), n.breaks = 7) +
  facet_wrap(~ lab) +
  theme_classic()+
  theme(panel.background = element_rect(fill = NA, colour = "black"),
        text = element_text(size = 16)) +
  labs( x = "Photoperiod (h)", 
        y = bquote("LEAR (m"^2~"/m"^2~" \u00B0Cd)") )

p_LEAR <- plot_grid(p_tt, p_pp, ncol = 1, align = "v", axis = "lr")
ggsave("Figures/ch3_LEAR.png",plot = p_LEAR,
       width = 7, height = 7, dpi = 320)
```

